---
title: "fitting exercise"
---

# Load required packages

```{r}
library(dplyr)
library(purrr)
library(ggplot2)
library(here)
library(tidyr)
library(tibble)
library(tidymodels)
library(stringr)
```

# Load the dataset using file.choose()

```{r}
model_data <- read.csv("/Users/valeriasantiago/Documents/arlynsantiago-MADA-portfolio/fitting-exercise/Mavoglurant_A2121_nmpk.csv")
```

# Check dataset using nrow() and ncol()
```{r}
nrow(model_data)
ncol(model_data)
```

# Create plot of DV by time with ID as a group factor

```{r}
# Plotting using ggplot2
p1 <- ggplot(model_data, aes(x = TIME, y = DV, group = ID, color = factor(DOSE))) +
  geom_line() +
  labs(title = "DV vs time with ID As A Group Factor",
       x = "Time",
       y = "DV") + theme_classic()
plot(p1)
```

# Data Cleaning
```{r}
# Filter rows so that OCC = 1 and remove rows where OCC = 2
dc1 <- model_data %>%
  filter(OCC == 1)

# Sum DV of each ID
dc2 <- dc1 %>%
  filter(TIME != 0) %>%  # ! to exclude observations with TIME = 0
  group_by(ID) %>%
  summarise(Y = sum(DV))

# Now data only includes TIME == 0
dc3 <- dc1 %>%
  filter(TIME == 0)

# Use left_join to combine d2 and d3 together
dc4 <- left_join(dc2, dc3, by = "ID")

dc5 <- dc4 %>%
  mutate(SEX = factor(SEX),
         RACE = factor(RACE)) %>%
  select(Y, DOSE, AGE, SEX, RACE, WT, HT)

```

# Exploratory Process

```{r}
# Summary table
summary_model = skimr::skim(dc5)
print(summary_model)

# A bar chart of total drug by age

dc6 <- dc5 %>%
  group_by(AGE) %>%
  summarize(avg_drug_level = mean(Y))

p1 <- ggplot(dc6, aes(x = AGE, y = avg_drug_level)) +
  geom_bar(stat = "identity", position = "dodge", alpha = 0.7) +
  labs(title = "Bar chart of Total Drug Level vs Age",
       x = "Age",
       y = "Total Drug Level") 
plot(p1)

# scatterplot of total drug by weight

p2 <- ggplot(dc5, aes(x = WT, y = Y)) +
  geom_point() +
  labs(title = "Scatterplot of Total Drug Level vs Weight",
       x = "Weight",
       y = "Total Drug Level") 
plot(p2)

# boxplot of total drug by dose level
p3 <- ggplot(dc5, aes(x = as.factor(DOSE), y = Y)) +
  geom_boxplot() +
  labs(title = "Boxplot of Total Drug Level vs Dose",
       x = "Dose Level",
       y = "Total Drug Level") 
plot(p3)

# boxplot of total drug by sex

p4 <- ggplot(dc5, aes(x = as.factor(SEX), y = Y)) +
  geom_boxplot() +
  labs(title = "Boxplot of Total Drug Level vs Sex",
       x = "Sex",
       y = "Total Drug Level") 
plot(p4)

# bar chart of total drug by race

dc7 <- dc5 %>%
  group_by(RACE) %>%
  summarize(
    mean_Y = mean(Y),
    sd_Y = sd(Y)
  )  


p5 <- ggplot(dc7, aes(x = RACE, y = mean_Y, fill = RACE)) +
  geom_bar(stat = "identity", position = "dodge", alpha = 0.7) +
  geom_errorbar(aes(ymin = mean_Y - sd_Y, ymax = mean_Y + sd_Y),
                position = position_dodge(width = 0.9), width = 0.2) +
  labs(title = "Bar Chart with Error Bars of Total Drug Level vs Race",
       x = "Race",
       y = "Mean Total Drug Level") 
plot(p5)
```



